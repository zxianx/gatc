# docker compose -f docker-compose.gatc.prod.yml up -d
# docker compose -f docker-compose.gatc.prod.yml up -d --force-recreate
version: '3.8'

services:
  gatc:
    container_name: gatc
    image: ghcr.io/zxianx/gatc:latest
    ports:
      - "8401:5401"
    environment:
      - DEV_LOCAL_ENV=false
      - XXX_CLEAN_OLD_VM_EXIST_EXCEED_H=72
    volumes:
      - /opt/gatc/conf:/app/conf:ro
    restart: unless-stopped
    networks:
      gatc-network:
        aliases:
          - gatc-service
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5401/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
    # 可选：添加资源限制
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4.0'
        reservations:
          memory: 512M
          cpus: '0.5'

networks:
  gatc-network:
    driver: bridge
    name: gatc-network