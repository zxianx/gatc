# Gemini Batch API æµ‹è¯•å·¥å…·

è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•Google Gemini Batch APIæ€§èƒ½å’Œè€—æ—¶çš„å®Œæ•´å·¥å…·é›†ï¼Œæä¾›ä»æ•°æ®ç”Ÿæˆåˆ°ç»“æœåˆ†æçš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- **æˆæœ¬èŠ‚çœ**: Batch APIæ¯”å®æ—¶APIèŠ‚çœçº¦50%è´¹ç”¨
- **æ‰¹é‡å¤„ç†**: æ”¯æŒ10-200ä¸ªè¯·æ±‚çš„æ‰¹é‡æµ‹è¯•
- **å¤šç§ç±»å‹**: æ”¯æŒç®€å•ã€å¤æ‚ã€æ··åˆç±»å‹è¯·æ±‚
- **å®æ—¶ç›‘æ§**: è‡ªåŠ¨ç›‘æ§ä½œä¸šçŠ¶æ€å˜åŒ–å’Œå¤„ç†è¿›åº¦
- **è¯¦ç»†åˆ†æ**: æä¾›å®Œæ•´çš„æ€§èƒ½ç»Ÿè®¡å’Œæˆæœ¬åˆ†ææŠ¥å‘Š

## ğŸ“ é¡¹ç›®ç»“æ„

```
gemini-batch-test/
â”œâ”€â”€ cmd/                           # å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ generate-test-data/        # ç”Ÿæˆæµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ create-batch-job/          # åˆ›å»ºæ‰¹å¤„ç†ä½œä¸š  
â”‚   â”œâ”€â”€ monitor-batch-job/         # ç›‘æ§ä½œä¸šçŠ¶æ€
â”‚   â”œâ”€â”€ get-batch-results/         # è·å–åˆ†æç»“æœ
â”‚   â””â”€â”€ full-test/                 # ä¸€é”®å®Œæ•´æµ‹è¯•
â”œâ”€â”€ internal/                      # å†…éƒ¨æ¨¡å—
â”‚   â”œâ”€â”€ gemini/                    # Gemini APIå°è£…
â”‚   â”œâ”€â”€ testdata/                  # æµ‹è¯•æ•°æ®ç”Ÿæˆ
â”‚   â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/tokens/                 # Tokené…ç½®ç›®å½•
â”œâ”€â”€ output/                        # æµ‹è¯•è¾“å‡ºç›®å½•
â””â”€â”€ README.md                      # ä½¿ç”¨è¯´æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–API Key

1. è®¿é—® [Google AI Studio](https://aistudio.google.com/app/apikey)
2. åˆ›å»ºæ–°çš„API Key
3. å¤åˆ¶API Keyå¤‡ç”¨

### 2. é…ç½®Token

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/tokens/example.json config/tokens/my-token.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®çš„API Key
vim config/tokens/my-token.json
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
```json
{
  "api_key": "AIzaSy...",  // å¡«å…¥çœŸå®API Key
  "project_id": "your-project-id",
  "name": "æˆ‘çš„æµ‹è¯•Token",
  "description": "ç”¨äºGemini Batch APIæµ‹è¯•"
}
```

### 3. ä¸€é”®å®Œæ•´æµ‹è¯•

```bash
# å¿«é€Ÿæµ‹è¯• (10ä¸ªç®€å•è¯·æ±‚)
go run cmd/full-test/main.go -token-file=config/tokens/my-token.json

# ä¸­ç­‰è§„æ¨¡æµ‹è¯• (50ä¸ªæ··åˆè¯·æ±‚)  
go run cmd/full-test/main.go -token-file=config/tokens/my-token.json -count=50 -type=mixed

# å¤§è§„æ¨¡æµ‹è¯• (100ä¸ªå¤æ‚è¯·æ±‚)
go run cmd/full-test/main.go -token-file=config/tokens/my-token.json -count=100 -type=complex
```

## ğŸ“‹ åˆ†æ­¥ä½¿ç”¨æŒ‡å—

### æ­¥éª¤1: ç”Ÿæˆæµ‹è¯•æ•°æ®

```bash
# ç”Ÿæˆ10ä¸ªç®€å•è¯·æ±‚
go run cmd/generate-test-data/main.go -count=10 -type=simple

# ç”Ÿæˆ50ä¸ªå¤æ‚è¯·æ±‚  
go run cmd/generate-test-data/main.go -count=50 -type=complex -output=test-complex-50.jsonl

# ç”Ÿæˆ100ä¸ªæ··åˆè¯·æ±‚
go run cmd/generate-test-data/main.go -count=100 -type=mixed
```

### æ­¥éª¤2: åˆ›å»ºæ‰¹å¤„ç†ä½œä¸š

```bash
go run cmd/create-batch-job/main.go \
  -token-file=config/tokens/my-token.json \
  -input=output/test-data/test-simple-10.jsonl
```

### æ­¥éª¤3: ç›‘æ§ä½œä¸šçŠ¶æ€

```bash
go run cmd/monitor-batch-job/main.go \
  -token-file=config/tokens/my-token.json \
  -job-id=batch_xxxxxxxxxxxx \
  -interval=10
```

### æ­¥éª¤4: è·å–åˆ†æç»“æœ

```bash  
go run cmd/get-batch-results/main.go \
  -token-file=config/tokens/my-token.json \
  -job-id=batch_xxxxxxxxxxxx \
  -save-report=auto
```

## ğŸ›ï¸ å‘½ä»¤å‚æ•°è¯´æ˜

### generate-test-data å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|-------|------|
| `-count` | 10 | ç”Ÿæˆè¯·æ±‚çš„æ•°é‡ |
| `-type` | simple | è¯·æ±‚ç±»å‹ (simple/complex/mixed) |
| `-model` | gemini-1.5-pro | ä½¿ç”¨çš„Geminiæ¨¡å‹ |
| `-output` | è‡ªåŠ¨ç”Ÿæˆ | è¾“å‡ºæ–‡ä»¶å |
| `-dir` | output/test-data | è¾“å‡ºç›®å½• |

### full-test å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|-------|------|  
| `-token-file` | - | Tokené…ç½®æ–‡ä»¶è·¯å¾„ (å¿…éœ€) |
| `-count` | 10 | ç”Ÿæˆè¯·æ±‚çš„æ•°é‡ |
| `-type` | simple | è¯·æ±‚ç±»å‹ (simple/complex/mixed) |
| `-model` | gemini-1.5-pro | ä½¿ç”¨çš„Geminiæ¨¡å‹ |
| `-interval` | 10 | çŠ¶æ€æ£€æŸ¥é—´éš”(ç§’) |
| `-save-all` | true | ä¿å­˜æ‰€æœ‰ä¸­é—´ç»“æœ |

## ğŸ“Š æµ‹è¯•ç±»å‹è¯´æ˜

### Simple (ç®€å•è¯·æ±‚)
- **ç‰¹ç‚¹**: ç®€å•é—®ç­”ï¼Œ10-20 tokens
- **ç¤ºä¾‹**: "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ"
- **è€—æ—¶**: 5-15åˆ†é’Ÿ
- **é€‚ç”¨**: å¿«é€ŸéªŒè¯APIå¯ç”¨æ€§

### Complex (å¤æ‚è¯·æ±‚)  
- **ç‰¹ç‚¹**: æ·±åº¦åˆ†æï¼Œ100-200 tokens
- **ç¤ºä¾‹**: è¯¦ç»†åˆ†æAIåœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨å‰æ™¯
- **è€—æ—¶**: 15-60åˆ†é’Ÿ
- **é€‚ç”¨**: æµ‹è¯•å¤æ‚ä»»åŠ¡å¤„ç†èƒ½åŠ›

### Mixed (æ··åˆè¯·æ±‚)
- **ç‰¹ç‚¹**: 50%ç®€å• + 50%å¤æ‚
- **è€—æ—¶**: 10-30åˆ†é’Ÿ
- **é€‚ç”¨**: çœŸå®åœºæ™¯æ¨¡æ‹Ÿ

### Advanced (é«˜çº§é…ç½®è¯·æ±‚)
- **ç‰¹ç‚¹**: å®Œæ•´é…ç½®å‚æ•°ï¼Œç±»ä¼¼ç”Ÿäº§ç¯å¢ƒ
- **ç¤ºä¾‹**: åŒ…å«GenerationConfigã€SafetySettingsã€SystemInstruction
- **è€—æ—¶**: 20-60åˆ†é’Ÿ
- **é€‚ç”¨**: æµ‹è¯•å®Œæ•´åŠŸèƒ½å’Œé«˜çº§å‚æ•°

## ğŸ“ˆ æ€§èƒ½é¢„æœŸ

| è¯·æ±‚æ•°é‡ | è¯·æ±‚ç±»å‹ | é¢„æœŸè€—æ—¶ | æˆæœ¬èŠ‚çœ |
|---------|---------|----------|---------|
| 10ä¸ª | Simple | 5-15åˆ†é’Ÿ | ~50% |
| 30ä¸ª | Advanced | 20-60åˆ†é’Ÿ | ~50% |
| 50ä¸ª | Mixed | 15-45åˆ†é’Ÿ | ~50% |
| 100ä¸ª | Complex | 1-6å°æ—¶ | ~50% |

## ğŸ” è¾“å‡ºç¤ºä¾‹

### å®æ—¶ç›‘æ§è¾“å‡º
```
ğŸ‘ï¸  ç›‘æ§Geminiæ‰¹å¤„ç†ä½œä¸š
   ä½œä¸šID: batch_abc123
   
[10:30:15] çŠ¶æ€å˜åŒ–: â†’ JOB_STATE_PENDING (è€—æ—¶: 1s)
[10:35:22] çŠ¶æ€å˜åŒ–: JOB_STATE_PENDING â†’ JOB_STATE_RUNNING (è€—æ—¶: 5m7s) 
[10:45:30] çŠ¶æ€å˜åŒ–: JOB_STATE_RUNNING â†’ JOB_STATE_SUCCEEDED (è€—æ—¶: 15m15s)

âœ… ä½œä¸šå®ŒæˆæˆåŠŸ! æ€»è€—æ—¶: 15m15s
```

### ç»“æœåˆ†ææŠ¥å‘Š
```
ğŸ“ˆ è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š:
   æ€»è¯·æ±‚æ•°: 50
   æˆåŠŸè¯·æ±‚: 48  
   å¤±è´¥è¯·æ±‚: 2
   æˆåŠŸç‡: 96.00%
   å¤„ç†æ—¶é—´: 10m8s
   å¹³å‡å•æ¬¡è€—æ—¶: 12.7s
   é¢„ä¼°æˆæœ¬èŠ‚çœ: ~50%

ğŸ¯ æ€§èƒ½åˆ†æ:
   âœ… æˆåŠŸç‡å¤§äº90%ï¼Œæ‰¹å¤„ç†ä½œä¸šè¡¨ç°è‰¯å¥½
   âœ… å¤„ç†é€Ÿåº¦æ­£å¸¸ï¼Œæ‰¹å¤„ç†æ•ˆç‡è‰¯å¥½
   ğŸ’° ä½¿ç”¨Batch APIç›¸æ¯”å®æ—¶APIèŠ‚çœçº¦50%è´¹ç”¨
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**: 
   - æ–‡ä»¶å¤§å°é™åˆ¶: 2GB
   - ä½œä¸šè¶…æ—¶: 48å°æ—¶
   - æ”¯æŒæ¨¡å‹: gemini-1.5-pro, gemini-1.5-flashç­‰

2. **ç½‘ç»œè¦æ±‚**:
   - éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
   - ä¸Šä¼ æ–‡ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´

3. **æˆæœ¬è€ƒè™‘**:
   - è™½ç„¶èŠ‚çœ50%ï¼Œä½†ä»ä¼šäº§ç”ŸAPIè´¹ç”¨
   - å»ºè®®å…ˆç”¨å°‘é‡è¯·æ±‚æµ‹è¯•

4. **å®‰å…¨æé†’**:
   - ä¸è¦å°†API Keyæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - å®šæœŸè½®æ¢API Key

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

**1. API Keyæ— æ•ˆ**
```
âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥ (çŠ¶æ€ç : 403): API key not valid
```
è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦æœ‰Gemini APIæƒé™

**2. æ–‡ä»¶æ ¼å¼é”™è¯¯**
```  
âŒ è§£æè¯·æ±‚å¤±è´¥: invalid character '}' looking for beginning of value
```
è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥JSONLæ–‡ä»¶æ ¼å¼ï¼Œæ¯è¡Œå¿…é¡»æ˜¯æœ‰æ•ˆJSON

**3. ä½œä¸šè¶…æ—¶**
```
âŒ ä½œä¸šå·²è¿‡æœŸ! æ€»è€—æ—¶: 48h0m0s
```
è§£å†³æ–¹æ¡ˆ: å‡å°‘è¯·æ±‚æ•°é‡ï¼Œæˆ–åˆ†æ‰¹å¤„ç†

### è°ƒè¯•æŠ€å·§

1. **å¢åŠ æ—¥å¿—**: ä½¿ç”¨ `-interval=5` å¢åŠ ç›‘æ§é¢‘ç‡
2. **æ£€æŸ¥çŠ¶æ€**: æ‰‹åŠ¨æŸ¥è¯¢ä½œä¸šçŠ¶æ€ç¡®è®¤è¿›åº¦
3. **åˆ†æ‰¹æµ‹è¯•**: å…ˆç”¨å°æ‰¹é‡æµ‹è¯•éªŒè¯é…ç½®

## ğŸ”— ç›¸å…³é“¾æ¥

- [Google Gemini APIæ–‡æ¡£](https://ai.google.dev/gemini-api/docs)
- [Batch APIå®˜æ–¹æ–‡æ¡£](https://ai.google.dev/gemini-api/docs/batch-api)
- [Google AI Studio](https://aistudio.google.com/)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼Œè¯·éµå®ˆGoogle APIä½¿ç”¨æ¡æ¬¾ã€‚