# Gemini Batch API æµ‹è¯•å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹æŒ‡å—

### 1. å‡†å¤‡å·¥ä½œ

1. **è·å–API Key**
   ```bash
   # è®¿é—® Google AI Studio: https://aistudio.google.com/app/apikey
   # åˆ›å»ºAPI Keyå¹¶å¤åˆ¶
   ```

2. **é…ç½®Token**
   ```bash
   # å¤åˆ¶é…ç½®æ¨¡æ¿
   cp config/tokens/example.json config/tokens/my-token.json
   
   # ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥API Key
   vim config/tokens/my-token.json
   ```

3. **éªŒè¯ç¯å¢ƒ**
   ```bash
   go version  # ç¡®ä¿Go 1.21+
   go mod tidy
   ```

### 2. ä¸€é”®æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆ10ä¸ªç®€å•è¯·æ±‚ï¼‰
./run-test.sh config/tokens/my-token.json simple 10

# å®Œæ•´åŠŸèƒ½æµ‹è¯•ï¼ˆ30ä¸ªé«˜çº§è¯·æ±‚ï¼‰
./run-test.sh config/tokens/my-token.json advanced 30

# æ€§èƒ½å‹åŠ›æµ‹è¯•ï¼ˆ100ä¸ªæ··åˆè¯·æ±‚ï¼‰  
./run-test.sh config/tokens/my-token.json mixed 100
```

### 3. åˆ†æ­¥æ‰§è¡Œ

```bash
# æ­¥éª¤1: ç”Ÿæˆæµ‹è¯•æ•°æ®
go run cmd/generate-test-data/main.go -count=20 -type=advanced

# æ­¥éª¤2: åˆ›å»ºæ‰¹å¤„ç†ä½œä¸š
go run cmd/create-batch-job/main.go \
  -token-file=config/tokens/my-token.json \
  -input=output/test-data/test-advanced-20.jsonl

# æ­¥éª¤3: ç›‘æ§ä½œä¸šçŠ¶æ€ï¼ˆä½¿ç”¨è¿”å›çš„ä½œä¸šIDï¼‰
go run cmd/monitor-batch-job/main.go \
  -token-file=config/tokens/my-token.json \
  -job-id=batch_xxxxxxxxxxxx

# æ­¥éª¤4: è·å–ç»“æœåˆ†æ
go run cmd/get-batch-results/main.go \
  -token-file=config/tokens/my-token.json \
  -job-id=batch_xxxxxxxxxxxx
```

## ğŸ“Š æµ‹è¯•ç±»å‹è¯¦è§£

### Simpleï¼ˆç®€å•è¯·æ±‚ï¼‰
- **ç”¨é€”**: å¿«é€ŸéªŒè¯APIè¿é€šæ€§
- **ç‰¹ç‚¹**: åŸºç¡€é—®ç­”ï¼Œæ— é«˜çº§é…ç½®
- **è€—æ—¶**: 5-15åˆ†é’Ÿï¼ˆ10-20ä¸ªè¯·æ±‚ï¼‰
- **ç¤ºä¾‹**:
  ```json
  {
    "custom_id": "simple-request-1",
    "method": "POST", 
    "url": "/v1/models/gemini-1.5-pro:generateContent",
    "body": {
      "contents": [{"parts": [{"text": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ"}]}]
    }
  }
  ```

### Complexï¼ˆå¤æ‚åˆ†æï¼‰
- **ç”¨é€”**: æµ‹è¯•å¤æ‚ä»»åŠ¡å¤„ç†èƒ½åŠ›
- **ç‰¹ç‚¹**: æ·±åº¦åˆ†æä»»åŠ¡ï¼Œé•¿æ–‡æœ¬ç”Ÿæˆ
- **è€—æ—¶**: 30-60åˆ†é’Ÿï¼ˆ20-50ä¸ªè¯·æ±‚ï¼‰
- **ç¤ºä¾‹**: æŠ€æœ¯åˆ†æã€å•†ä¸šæ¨¡å¼åˆ†æç­‰

### Mixedï¼ˆæ··åˆç±»å‹ï¼‰
- **ç”¨é€”**: æ¨¡æ‹ŸçœŸå®ä½¿ç”¨åœºæ™¯
- **ç‰¹ç‚¹**: 50%ç®€å• + 50%å¤æ‚è¯·æ±‚
- **è€—æ—¶**: 15-45åˆ†é’Ÿï¼ˆ30-50ä¸ªè¯·æ±‚ï¼‰
- **ä¼˜åŠ¿**: å¹³è¡¡æµ‹è¯•æ•ˆæœå’Œæ—¶é—´æˆæœ¬

### Advancedï¼ˆé«˜çº§é…ç½®ï¼‰â­ **æ–°å¢**
- **ç”¨é€”**: æµ‹è¯•å®Œæ•´Gemini APIåŠŸèƒ½
- **ç‰¹ç‚¹**: åŒ…å«å®Œæ•´é…ç½®å‚æ•°ï¼Œç±»ä¼¼ç”Ÿäº§ç¯å¢ƒ
- **é…ç½®**:
  - `GenerationConfig`: topP, temperature, maxOutputTokens
  - `ThinkingConfig`: includeThoughts, thinkingBudget  
  - `SafetySettings`: å®‰å…¨è¿‡æ»¤è®¾ç½®
  - `SystemInstruction`: ç³»ç»Ÿè§’è‰²æŒ‡ä»¤
- **è€—æ—¶**: 20-60åˆ†é’Ÿï¼ˆ10-30ä¸ªè¯·æ±‚ï¼‰
- **ç¤ºä¾‹**:
  ```json
  {
    "generationConfig": {
      "topP": 0.95,
      "temperature": 0.7,
      "maxOutputTokens": 2048,
      "thinkingConfig": {
        "includeThoughts": true,
        "thinkingBudget": 32768
      }
    },
    "safetySettings": [
      {"category": "HARM_CATEGORY_HARASSMENT", "threshold": "OFF"}
    ],
    "systemInstruction": {
      "parts": [{"text": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ•™å¸ˆå’Œå­¦è€…..."}]
    }
  }
  ```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æ•°æ®

| æµ‹è¯•åœºæ™¯ | è¯·æ±‚æ•°é‡ | é¢„æœŸè€—æ—¶ | æˆæœ¬èŠ‚çœ | å»ºè®®ç”¨é€” |
|---------|---------|----------|---------|---------|
| å¿«é€ŸéªŒè¯ | 10ä¸ª Simple | 5-15åˆ†é’Ÿ | ~50% | APIè¿é€šæ€§æµ‹è¯• |
| åŠŸèƒ½æµ‹è¯• | 30ä¸ª Advanced | 20-60åˆ†é’Ÿ | ~50% | å®Œæ•´åŠŸèƒ½éªŒè¯ |
| æ€§èƒ½æµ‹è¯• | 50ä¸ª Mixed | 15-45åˆ†é’Ÿ | ~50% | çœŸå®åœºæ™¯æ¨¡æ‹Ÿ |
| å‹åŠ›æµ‹è¯• | 100ä¸ª Complex | 1-6å°æ—¶ | ~50% | å¤§è§„æ¨¡å¤„ç†èƒ½åŠ› |

## ğŸ” ç»“æœåˆ†æç¤ºä¾‹

### ç›‘æ§è¾“å‡º
```
ğŸ‘ï¸  ç›‘æ§Geminiæ‰¹å¤„ç†ä½œä¸š
   ä½œä¸šID: batch_abc123

[10:30:15] çŠ¶æ€å˜åŒ–: â†’ JOB_STATE_PENDING (è€—æ—¶: 1s)
[10:35:22] çŠ¶æ€å˜åŒ–: PENDING â†’ RUNNING (è€—æ—¶: 5m7s)
[10:45:30] çŠ¶æ€å˜åŒ–: RUNNING â†’ SUCCEEDED (è€—æ—¶: 15m15s)

âœ… ä½œä¸šå®ŒæˆæˆåŠŸ! æ€»è€—æ—¶: 15m15s
```

### ç»“æœåˆ†æ
```
ğŸ“ˆ è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š:
   æ€»è¯·æ±‚æ•°: 30
   æˆåŠŸè¯·æ±‚: 29
   å¤±è´¥è¯·æ±‚: 1
   æˆåŠŸç‡: 96.67%
   å¤„ç†æ—¶é—´: 10m8s
   å¹³å‡å•æ¬¡è€—æ—¶: 20.9s
   é¢„ä¼°æˆæœ¬èŠ‚çœ: ~50%

ğŸ¯ æ€§èƒ½åˆ†æ:
   âœ… æˆåŠŸç‡å¤§äº90%ï¼Œæ‰¹å¤„ç†ä½œä¸šè¡¨ç°è‰¯å¥½
   âœ… å¤„ç†é€Ÿåº¦æ­£å¸¸ï¼Œæ‰¹å¤„ç†æ•ˆç‡è‰¯å¥½
   ğŸ’° ä½¿ç”¨Batch APIç›¸æ¯”å®æ—¶APIèŠ‚çœçº¦50%è´¹ç”¨
```

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### Q1: API KeyéªŒè¯å¤±è´¥
```
âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥ (çŠ¶æ€ç : 403): API key not valid
```
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®å¤åˆ¶
2. ç¡®è®¤API Keyæœ‰Gemini APIè®¿é—®æƒé™
3. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

### Q2: ä½œä¸šé•¿æ—¶é—´åœç•™åœ¨PENDINGçŠ¶æ€
```
[10:30:15] çŠ¶æ€: JOB_STATE_PENDING (è€—æ—¶: 30m0s)
```
**è§£å†³æ–¹æ¡ˆ**:
1. æ­£å¸¸ç°è±¡ï¼ŒGoogleå¤„ç†é˜Ÿåˆ—å¯èƒ½è¾ƒé•¿
2. å»ºè®®æ£€æŸ¥é—´éš”è°ƒæ•´ä¸º30-60ç§’
3. å¦‚æœè¶…è¿‡2å°æ—¶ï¼Œè€ƒè™‘é‡æ–°æäº¤

### Q3: éƒ¨åˆ†è¯·æ±‚å¤±è´¥
```
âŒ è¯·æ±‚å¤±è´¥ [advanced-request-15]: The model is overloaded
```
**è§£å†³æ–¹æ¡ˆ**:
1. æ¨¡å‹è¿‡è½½ï¼Œç¨åé‡è¯•
2. å‡å°‘å•æ‰¹æ¬¡è¯·æ±‚æ•°é‡
3. åˆ†å¤šä¸ªæ‰¹æ¬¡å¤„ç†

### Q4: ç½‘ç»œè¿æ¥é—®é¢˜
```
âŒ å‘é€ä¸Šä¼ è¯·æ±‚å¤±è´¥: dial tcp: i/o timeout
```
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§
2. ä½¿ç”¨ç§‘å­¦ä¸Šç½‘å·¥å…·
3. é‡è¯•ä¸Šä¼ æ“ä½œ

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ¨¡å‹ç‰ˆæœ¬
```bash
go run cmd/generate-test-data/main.go \
  -model=gemini-1.5-flash \
  -count=20 -type=simple
```

### è°ƒæ•´ç›‘æ§é—´éš”
```bash
go run cmd/monitor-batch-job/main.go \
  -interval=30 \
  -token-file=config/tokens/my-token.json \
  -job-id=batch_xxxxxxxxxxxx
```

### è‡ªå®šä¹‰è¾“å‡ºç›®å½•
```bash
go run cmd/generate-test-data/main.go \
  -dir=./my-tests \
  -count=50 -type=mixed
```

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**: å…ˆç”¨ç®€å•ç±»å‹æµ‹è¯•è¿é€šæ€§
2. **ç”Ÿäº§éªŒè¯**: ä½¿ç”¨advancedç±»å‹æµ‹è¯•å®Œæ•´åŠŸèƒ½
3. **æ€§èƒ½æµ‹è¯•**: ä½¿ç”¨mixedç±»å‹æ¨¡æ‹ŸçœŸå®åœºæ™¯
4. **å¤§è§„æ¨¡å¤„ç†**: åˆ†æ‰¹æ¬¡æ‰§è¡Œï¼Œæ¯æ‰¹50-100ä¸ªè¯·æ±‚
5. **ç›‘æ§ç­–ç•¥**: ä½¿ç”¨è¾ƒé•¿æ£€æŸ¥é—´éš”ï¼ˆ30-60ç§’ï¼‰èŠ‚çœAPIè°ƒç”¨
6. **é”™è¯¯å¤„ç†**: ä¿ç•™å¤±è´¥è¯·æ±‚ï¼Œåˆ†æå¤±è´¥åŸå› åé‡è¯•

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: README.md
- **é—®é¢˜åé¦ˆ**: é¡¹ç›®IssueåŒº
- **APIæ–‡æ¡£**: https://ai.google.dev/gemini-api/docs/batch-api
- **Google AI Studio**: https://aistudio.google.com/

---

*ğŸ‰ ç°åœ¨æ‚¨å·²ç»æŒæ¡äº†Gemini Batch APIæµ‹è¯•å·¥å…·çš„å®Œæ•´ä½¿ç”¨æ–¹æ³•ï¼å¼€å§‹æ‚¨çš„æ‰¹å¤„ç†æµ‹è¯•ä¹‹æ—…å§ï¼*